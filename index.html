<!DOCTYPE HTML>
<body>
	<canvas id="canvas" style="width: 100%;"></canvas>
</body>

<script>
	function BETTERCANVAS(canvasID){
		this.canvas = document.getElementById(canvasID);
		this.ctx = this.canvas.getContext("2d");
		this.width = this.canvas.clientWidth;
		this.height = this.canvas.clientHeight;
		this.size = this.width * this.height;
		this.pointList = new Uint8ClampedArray(this.size * 4);

	}
	BETTERCANVAS.prototype = {
		_createCanvas:function(){
			var canvas = document.getElementById('canvas');
			return canvas;
		},
		addBall: function(x0, y0, radius){
            var orad = radius;
            var increment = map_range(1, 0, orad,0,255);
            var x = radius;
            var y = 0;
            var radiusError = 1 - x;
            while (x >= y){
                this.horizontalLine(-x + x0, y + y0, x + x0, y + y0);
                this.horizontalLine(-y + x0, -x + y0, y + x0, -x + y0);
                this.horizontalLine(-x + x0, -y + y0, x + x0, -y + y0);
                this.horizontalLine(-y + x0, x + y0, y + x0, x + y0);
                y++;
                if (radiusError<0){
                    radiusError += 2 * y + 1;
                }
                else{
                    x--;
                    radiusError += 2 * (y - x) + 1;
                }
            } 
            radius--;
		},
		horizontalLine: function(xi, yi, xf, yf){
			// Assumes xi is on the left and xf is on the right
			var width = Math.round(Math.abs(xi-xf)/2);
			var xPointer = xi;
			while (xPointer <= xf){
				this.pointList[this.getRIndexPos(xPointer, yi) + 3] = 255;
				xPointer ++;
			}
		},
		apply: function(){
			if(!this.imageData) this.imageData = this.ctx.createImageData(this.width, this.height);
		    this.imageData.data.set(this.pointList);
		    this.ctx.putImageData(this.imageData, 0, 0);
		},
		getRIndexPos: function(x,y){
			var rIndexPos = (y*this.width+x)*4;
			return rIndexPos;
		},
		map_range: function(value, low1, high1, low2, high2) {
            return low2 + (high2 - low2) * (value - low1) / (high1 - low1);
        }
	};
	var b = new BETTERCANVAS("canvas");
	var xpos = 100;
	var time = new Date();
	var counter = 0;

	b.canvas.onclick = function(e){
		b.addBall(e.x, e.y, 20);
		b.apply()
	}
	

</script>