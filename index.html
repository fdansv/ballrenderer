<!DOCTYPE HTML>
<body>
	<canvas id="canvas" style="width: 100%;"></canvas>
</body>

<script>
	function BETTERCANVAS(canvasID){
		this.canvas = document.getElementById(canvasID);
		this.ctx = this.canvas.getContext("2d");
		this.width = this.canvas.clientWidth;
		this.height = this.canvas.clientHeight;
		this.size = this.width * this.height;
		this.pointList = new Uint8ClampedArray(this.size * 4);
		this.radius = 30;
		this.drawnTemp = {};

	}
	BETTERCANVAS.prototype = {
		_createCanvas:function(){
			var canvas = document.getElementById('canvas');
			return canvas;
		},
		addBall: function(x0, y0){
            var orad = this.radius;
            var increment = this.map_range(1, 0, orad,0,255);
            var x = this.radius;
            var y = 0;
            var radiusError = 1 - x;
            while (x >= y){
                this.horizontalLine(-x + x0, y + y0, x + x0, y + y0, x0,y0);
                this.horizontalLine(-y + x0, -x + y0, y + x0, -x + y0, x0,y0);
                this.horizontalLine(-x + x0, -y + y0, x + x0, -y + y0, x0,y0);
                this.horizontalLine(-y + x0, x + y0, y + x0, x + y0, x0,y0);
                y++;
                if (radiusError<0){
                    radiusError += 2 * y + 1;
                }
                else{
                    x--;
                    radiusError += 2 * (y - x) + 1;
                }
            }
            this.drawnTemp = {};
		},
		addPoint: function(x, y, alpha){
			this.pointList[this.getRIndexPos(x, y) + 3] = Math.min(this.pointList[this.getRIndexPos(x, y) + 3]+alpha, 255);
		},
		horizontalLine: function(xi, yi, xf, yf, x0, y0){
			function lineDistance(x,y){
			  var xs = Math.pow(x - x0, 2);
			  var ys = Math.pow(y - y0, 2);
			  return Math.sqrt( xs + ys );
			}
			// Assumes xi is on the left and xf is on the right
			var xPointer = xi;
			while (xPointer <= xf){
				if(typeof this.drawnTemp[xPointer+":"+yi] === "undefined"){
					var alpha = Math.round(this.map_range(lineDistance(xPointer, yi), 0, this.radius, 180, 0));
					this.addPoint(xPointer, yi, alpha);
					this.drawnTemp[xPointer+":"+yi]=true;
				}
				xPointer ++;
			}
		},
		draw: function(){
			if(!this.imageData) this.imageData = this.ctx.createImageData(this.width, this.height);
		    this.imageData.data.set(this.pointList);
		    this.ctx.putImageData(this.imageData, 0, 0);
		},
		invalidate: function(){
			if(!this.imageData) this.imageData = this.ctx.createImageData(this.width, this.height);
			this.pointList = new Uint8ClampedArray(this.size * 4);
		    this.imageData.data.set(this.pointList);
		    this.ctx.putImageData(this.imageData, 0, 0);
		},
		getRIndexPos: function(x,y){
			var rIndexPos = (y*this.width+x)*4;
			return rIndexPos;
		},
		map_range: function(value, low1, high1, low2, high2) {
            return low2 + (high2 - low2) * (value - low1) / (high1 - low1);
        }
	};
	var b = new BETTERCANVAS("canvas");
	var xpos = 100;
	var time = new Date();
	var counter = 0;

		b.addBall(100, 100, 20);
		b.addBall(120, 100, 20);
		b.apply();
	

</script>